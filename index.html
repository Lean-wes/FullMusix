<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‚úß ùêÖùêÆùê•ùê• ùêå‡∏¢‡∏£‡πÄ◊ê ‚úß</title>
  <!-- ESTILOS GENERALES -->
  <style>
    :root {
      --gold: #D4AF37;
      --black: #000;
      --dark: #111;
      --gray: #444;
      --blue: #007BFF;
      --sidebar-width: 240px;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(to bottom, #000000, #1c1c1c); color: #fff; min-height: 100vh; }
    a { color: var(--gold); text-decoration: none; }
    /* LOGIN WRAPPER */
    #loginWrapper { display: flex; align-items: center; justify-content: center; padding: 0 10px; min-height: 100vh; }
    .login-container { background-color: #2c2c2c; border-radius: 16px; padding: 30px 20px; box-shadow: 0 0 20px rgba(0,0,0,0.7); width: 100%; max-width: 400px; text-align: center; }
    .login-container h1 { font-size: 2rem; color: var(--gold); margin-bottom:20px; }
    .tabs { display:flex; margin-bottom:20px; }
    .tab { flex:1; padding:10px; border-bottom:2px solid transparent; text-align:center; color:#aaa; cursor:pointer; transition:0.3s; }
    .tab.active { border-color: var(--gold); color: var(--gold); }
    .login-container form { display:none; text-align:left; }
    .login-container form.active { display:block; }
    .login-container label { display:block; font-size:0.9rem; margin-bottom:5px; }
    .login-container input { width:100%; height:40px; padding:10px; margin:5px 0 15px; border:none; border-radius:8px; background:#444; color:#fff; font-size:1rem; }
    .password-toggle { position: relative; }
    .password-toggle .emoji { position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer; }
    .login-container button { width:100%; padding:12px; background: var(--gold); color:#000; border:none; border-radius:8px; font-weight:bold; margin-top:15px; height:45px; cursor:pointer; }
    .login-container .google-btn { background:#4285F4; color:#fff; }
    /* APP WRAPPER */
    #appWrapper { display:none; }
    header { position: fixed; top:0; left:0; right:0; height:60px; background: var(--black); display:flex; align-items:center; padding:0 1rem; z-index:1000; }
    header h1 { flex:1; text-align:center; font-size:1.25rem; color: var(--gold); }
    #menuBtn, #logoutBtn { background:none; border:none; cursor:pointer; color:var(--gold); }
    #menuBtn { font-size:1.5rem; }
    #logoutBtn { font-size:1rem; margin-left:auto; }
    #sidebar { position: fixed; top:60px; bottom:0; left:0; width: var(--sidebar-width); background: var(--black); overflow-y:auto; transition: transform 0.3s ease; transform: translateX(-100%); z-index:900; }
    #sidebar.open { transform: translateX(0); }
    #closeBtn { position:absolute; top:10px; right:10px; background:none; border:none; color:var(--gold); font-size:1.5rem; cursor:pointer; }
    nav ul { list-style:none; padding:1rem; margin-top:40px; }
    .nav-btn { width:100%; padding:0.75rem 1rem; background:none; border:none; color:#ccc; text-align:left; font-size:1rem; cursor:pointer; transition:0.2s; }
    .nav-btn.active, .nav-btn:hover { background: var(--gray); color:#fff; }
    #overlay { position:fixed; top:60px; left:0; right:0; bottom:0; background:rgba(0,0,0,0.4); display:none; z-index:850; }
    #overlay.active { display:block; }
    main { margin-top:60px; margin-left:0; padding:1rem; transition: margin-left 0.3s ease; }
    main.shifted { margin-left: var(--sidebar-width); }
    .section { display:none; }
    .section.active { display:block; }
    .upload-area, .player-area, .section-content { background: var(--dark); border-radius:8px; padding:1rem; margin-bottom:1rem; border:1px solid var(--gray); }
    .upload-area input[type=file], .section-content input[type=text], .upload-area select { width:100%; padding:0.5rem; background:var(--dark); border:1px solid var(--gray); color:#fff; border-radius:4px; margin-top:0.5rem; }
    .upload-area input[type=text] { margin-top:0; }
    .upload-area button, .section-content button { width:100%; margin-top:0.5rem; padding:0.75rem; background:var(--gold); border:none; border-radius:4px; color:var(--black); font-weight:bold; cursor:pointer; }
    footer.controls { position:fixed; bottom:0; left:0; right:0; background: var(--black); padding:0.5rem 1rem; display:flex; justify-content:space-around; border-top:1px solid var(--gray); }
    footer.controls button { background:none; border:none; font-size:1.5rem; cursor:pointer; color:var(--gold); }
    footer.controls button.active { color: var(--blue); }
    #trackInfo { margin-top:0.5rem; font-size:0.9rem; color:#ccc; }
    ul.simple-list { list-style:none; padding:0; margin:0; }
    ul.simple-list li { margin-bottom:0.5rem; display:flex; justify-content:space-between; align-items:center; }
    ul.simple-list li button { background:none; border:none; color:var(--gold); cursor:pointer; }
    .folder { cursor:pointer; padding:0.5rem; display:flex; justify-content:space-between; background:var(--gray); border-radius:4px; margin-bottom:0.5rem; }
    .folder .name { flex:1; }
    .folder .actions button { margin-left:0.5rem; font-size:0.9rem; }
    @media (max-width: 600px) {
      header h1 { font-size:1rem; }
      .upload-area, .player-area { padding:0.75rem; }
      .nav-btn { font-size:0.9rem; padding:0.5rem 0.75rem; }
    }
  </style>
</head>
<body>
  <div id="loginWrapper">
    <div class="login-container">
      <h1>‚úß ùêÖùêÆùê•ùê• ùêå‡∏¢‡∏£‡πÄ◊ê ‚úß</h1>
      <div class="tabs">
        <div class="tab active" data-tab="login">Iniciar Sesi√≥n</div>
        <div class="tab" data-tab="register">Registrarse</div>
      </div>
      <form id="login" class="active">
        <label for="loginEmail">Correo electr√≥nico</label>
        <input type="email" id="loginEmail" placeholder="correo@ejemplo.com" required>
        <label for="loginPassword">Contrase√±a</label>
        <div class="password-toggle">
          <input type="password" id="loginPassword" placeholder="Contrase√±a" required>
          <span class="emoji" id="toggleLoginEmoji">ü§ê</span>
        </div>
        <button type="submit">Entrar</button>
        <button type="button" id="googleLoginBtn" class="google-btn">Entrar con Google</button>
      </form>
      <form id="register">
        <label for="registerEmail">Correo electr√≥nico</label>
        <input type="email" id="registerEmail" placeholder="correo@ejemplo.com" required>
        <label for="registerPassword">Contrase√±a</label>
        <div class="password-toggle">
          <input type="password" id="registerPassword" placeholder="Contrase√±a" required>
          <span class="emoji" id="toggleRegisterEmoji">ü§ê</span>
        </div>
        <label for="confirmPassword">Confirmar contrase√±a</label>
        <div class="password-toggle">
          <input type="password" id="confirmPassword" placeholder="Confirmar contrase√±a" required>
          <span class="emoji" id="toggleConfirmEmoji">ü§ê</span>
        </div>
        <button type="submit">Registrarse</button>
        <button type="button" class="google-btn">Registrarse con Google</button>
      </form>
    </div>
  </div>
  <div id="appWrapper">
    <header>
      <button id="menuBtn" aria-label="Mostrar/Ocultar men√∫">‚ò∞</button>
      <h1>‚úß ùêÖùêÆùê•ùê• ùêå‡∏¢‡∏£‡πÄ◊ê ‚úß</h1>
      <button id="logoutBtn">Cerrar Sesi√≥n</button>
    </header>
    <aside id="sidebar">
      <button id="closeBtn" aria-label="Ocultar men√∫">‚´∑</button>
      <nav><ul>
        <li><button class="nav-btn active" data-target="section-Inicio">Inicio</button></li>
        <li><button class="nav-btn" data-target="section-Todas">Todas las M√∫sicas</button></li>
        <li><button class="nav-btn" data-target="section-Recientes">Recientes</button></li>
        <li><button class="nav-btn" data-target="section-Buscar">Buscar</button></li>
        <li><button class="nav-btn" data-target="section-Bibliotecas">Bibliotecas</button></li>
      </ul></nav>
    </aside>
    <div id="overlay"></div>
    <main id="mainContent">
      <section id="section-Inicio" class="section active">
        <div class="upload-area">
          <h2>Subir M√∫sica</h2>
          <label for="librarySelect">Seleccionar Biblioteca:</label>
          <select id="librarySelect"></select>
          <input type="text" id="uploadNewLibraryName" placeholder="O ingresa nueva biblioteca">
          <input type="file" id="fileUpload" accept="audio/*">
          <button id="uploadBtn" disabled>Subir a Supabase</button>
        </div>
        <div class="player-area">
          <h2>Reproductor</h2>
          <audio id="audio-player" controls style="width:100%;"></audio>
          <div id="trackInfo">Sin pista seleccionada</div>
        </div>
      </section>
      <section id="section-Todas" class="section">
        <div class="section-content">
          <h2>Todas las M√∫sicas</h2>
          <ul id="allTracksList" class="simple-list"></ul>
        </div>
      </section>
      <section id="section-Recientes" class="section">
        <div class="section-content">
          <h2>Recientes</h2>
          <ul id="recentList" class="simple-list"></ul>
        </div>
      </section>
      <section id="section-Buscar" class="section">
        <div class="section-content">
          <h2>Buscar M√∫sica</h2>
          <input type="text" id="searchInput" placeholder="Buscar...">
          <ul id="searchResults" class="simple-list"></ul>
        </div>
      </section>
      <section id="section-Bibliotecas" class="section">
        <div class="section-content">
          <h2>Bibliotecas</h2>
          <div id="libraryControls">
            <input type="text" id="newLibraryName" placeholder="Nueva biblioteca">
            <button id="createLibraryBtn">Crear Biblioteca</button>
          </div>
          <ul id="libraryList" class="simple-list"></ul>
        </div>
      </section>
    </main>
    <footer class="controls">
      <button id="shuffleBtn">üîÄ</button>
      <button id="repeatBtn">üîÅ</button>
      <button id="playPauseBtn">‚èØÔ∏è</button>
      <button id="speedBtn">1x</button>
    </footer>
  </div>  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>  <script>
    const supabaseUrl = 'https://bgjsqhicnacupnqmfvho.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJnanNxaGljbmFjdXBucW1mdmhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzMzAxMzMsImV4cCI6MjA2MTkwNjEzM30.stuZwCskpXLPjBLPGLpzgkFjVYtq1pePyzXQUqdK2Pk';
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    window.loadLibraries = async () => {
      const { data: items, error } = await supabaseClient.storage.from('tracks').list('', { limit: 100 });
      if (error) return console.error('Error cargando bibliotecas:', error);
      const libs = [...new Set(items
        .filter(i => i.name.includes('/'))
        .map(i => i.name.split('/')[0]))];
      // Rellenar select de subida
      const select = document.getElementById('librarySelect');
      select.innerHTML = '<option value="">-- Seleccionar --</option>' + libs.map(l => `<option value="${l}">${l}</option>`).join('');
      // Mostrar en secci√≥n Bibliotecas
      const ul = document.getElementById('libraryList'); ul.innerHTML = '';
      libs.forEach(l => {
        const li = document.createElement('li');
        li.innerHTML = `<div class="folder">
          <span class="name">${l}</span>
          <div class="actions">
            <button onclick="window.deleteLibrary('${l}')">Eliminar</button>
          </div>
        </div>`;
        ul.appendChild(li);
      });
    };

    window.loadAllTracks = async () => {
      // Cargar bibliotecas y luego listar archivos
      const { data: items, error: errLib } = await supabaseClient.storage.from('tracks').list('', { limit: 100 });
      if (errLib) return console.error(errLib);
      const libs = [...new Set(items.filter(i => i.name.includes('/')).map(i => i.name.split('/')[0]))];
      const all = [];
      for (const lib of libs) {
        const { data: files, error } = await supabaseClient.storage.from('tracks').list(lib, { limit: 1000 });
        if (error) console.error('Error listando', lib, error);
        else files.forEach(f => {
          if (f.name === '.keep') return;
          all.push({ library: lib, name: f.name });
        });
      }
      const ul = document.getElementById('allTracksList'); ul.innerHTML = '';
      all.forEach(t => {
        const path = `${t.library}/${t.name}`;
        const url = `${supabaseUrl}/storage/v1/object/public/tracks/${encodeURIComponent(path)}`;
        const li = document.createElement('li');
        li.innerHTML = `<span>${t.library} / ${t.name}</span><button onclick="window.playUrl('${url}')">‚ñ∂Ô∏è</button>`;
        ul.appendChild(li);
      });
    };

    window.deleteLibrary = async (name) => {
      // Eliminar todos los objetos de la carpeta
      const { data: items, error } = await supabaseClient.storage.from('tracks').list(name, { limit: 1000 });
      if (error) return console.error('Error eliminando carpeta', name, error);
      const paths = items.map(i => `${name}/${i.name}`);
      if (paths.length) {
        await supabaseClient.storage.from('tracks').remove(paths);
      }
      await window.loadLibraries();
      await window.loadAllTracks();
    };

    window.playUrl = (url) => {
      const audio = document.getElementById('audio-player');
      audio.src = url;
      audio.play();
      document.getElementById('trackInfo').textContent = url.split('/').pop();
    };

    document.addEventListener('DOMContentLoaded', () => {
      // Autenticaci√≥n
      supabaseClient.auth.getSession().then(({ data: { session } }) => {
        if (session) initApp();
      });
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        await supabaseClient.auth.signOut(); location.reload();
      });
      document.querySelectorAll('.google-btn').forEach(btn => btn.addEventListener('click', async () => {
        await supabaseClient.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.href } });
      }));
      // Tabs
      const tabs = document.querySelectorAll('.tab'), forms = document.querySelectorAll('.login-container form');
      tabs.forEach(tab => tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.toggle('active', t===tab));
        forms.forEach(f => f.classList.toggle('active', f.id === tab.dataset.tab));
      }));
      // Toggle password
      ['Login','Register','Confirm'].forEach(type => {
        const emoji = document.getElementById('toggle'+type+'Emoji');
        const input = document.getElementById(type.toLowerCase()+'Password');
        emoji.addEventListener('click', () => {
          const show = input.type === 'password';
          input.type = show ? 'text' : 'password';
          emoji.textContent = show ? 'ü§´' : 'ü§ê';
        });
      });
      // Register
      document.getElementById('register').addEventListener('submit', async e => {
        e.preventDefault();
        const email = document.getElementById('registerEmail').value;
        const pwd = document.getElementById('registerPassword').value;
        const conf = document.getElementById('confirmPassword').value;
        if (pwd !== conf) return alert('Las contrase√±as no coinciden');
        const { error } = await supabaseClient.auth.signUp({ email, password: pwd });
        if (error) return alert('Error: ' + error.message);
        alert('Registrado. Revisa tu correo.'); tabs[0].click();
      });
      // Login
      document.getElementById('login').addEventListener('submit', async e => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const pwd = document.getElementById('loginPassword').value;
        const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password: pwd });
        if (error) return alert('Error: ' + error.message);
        initApp();
      });

      // Navegaci√≥n sidebar
      const menuBtn = document.getElementById('menuBtn'), closeBtn = document.getElementById('closeBtn'), overlay = document.getElementById('overlay'), sidebar = document.getElementById('sidebar'), main = document.getElementById('mainContent');
      const navBtns = document.querySelectorAll('.nav-btn'), sections = document.querySelectorAll('.section');
      function toggleSidebar() {
        const open = !sidebar.classList.toggle('open');
        main.classList.toggle('shifted', !open);
        overlay.classList.toggle('active', !open);
      }
      menuBtn.addEventListener('click', toggleSidebar);
      closeBtn.addEventListener('click', toggleSidebar);
      overlay.addEventListener('click', () => sidebar.classList.contains('open') && toggleSidebar());
      navBtns.forEach(btn => btn.addEventListener('click', () => {
        navBtns.forEach(b => b.classList.remove('active'));
        sections.forEach(s => s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.target).classList.add('active');
        toggleSidebar();
      }));

      // Inicializar app
      async function initApp() {
        document.getElementById('loginWrapper').style.display = 'none';
        document.getElementById('appWrapper').style.display = 'block';
        await loadLibraries();
        await loadAllTracks();
      }

      // L√≥gica de subida
      const fileInput = document.getElementById('fileUpload'), uploadBtn = document.getElementById('uploadBtn');
      uploadBtn.disabled = true;
      fileInput.addEventListener('change', () => { uploadBtn.disabled = !fileInput.files.length; });
      uploadBtn.addEventListener('click', async () => {
        const file = fileInput.files[0]; if (!file) return;
        const selectVal = document.getElementById('librarySelect').value.trim();
        const newLib = document.getElementById('uploadNewLibraryName').value.trim();
        const lib = newLib || selectVal;
        if (!lib) return alert('Selecciona o ingresa una biblioteca');
        const path = `${lib}/${Date.now()}_${file.name}`;
        const { error } = await supabaseClient.storage.from('tracks').upload(path, file);
        if (error) return alert('Error al subir: ' + error.message);
        alert('Subido correctamente');
        fileInput.value = ''; uploadBtn.disabled = true;
        document.getElementById('uploadNewLibraryName').value = '';
        await loadLibraries(); await loadAllTracks();
      });

      // Controles de reproducci√≥n
      const audio = document.getElementById('audio-player');
      document.getElementById('shuffleBtn').addEventListener('click', () => audio.loop = !audio.loop);
      document.getElementById('repeatBtn').addEventListener('click', () => audio.loop = !audio.loop);
      document.getElementById('playPauseBtn').addEventListener('click', () => audio.paused ? audio.play() : audio.pause());
      document.getElementById('speedBtn').addEventListener('click', () => {
        const speeds = [1,1.5,2];
        let idx = speeds.indexOf(audio.playbackRate);
        audio.playbackRate = speeds[(idx+1) % speeds.length];
        document.getElementById('speedBtn').textContent = audio.playbackRate + 'x';
      });

      // Recientes y b√∫squeda
      let recentTracks = [];
      audio.addEventListener('play', () => {
        const info = document.getElementById('trackInfo').textContent;
        if (info && !recentTracks.includes(info)) {
          recentTracks.unshift(info);
          if (recentTracks.length > 10) recentTracks.pop();
          const ul = document.getElementById('recentList');
          ul.innerHTML = recentTracks.map(name => `<li>${name}</li>`).join('');
        }
      });
      document.getElementById('searchInput').addEventListener('input', e => {
        const q = e.target.value.toLowerCase();
        const ul = document.getElementById('searchResults');
        ul.innerHTML = recentTracks.filter(n => n.toLowerCase().includes(q)).map(n => `<li>${n}</li>`).join('');
      });

    });
  </script></body>
  </html>
