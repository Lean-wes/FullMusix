<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Subir Música</title>
</head>
<body>
  <h1>Subir archivo de música</h1>
  <input type="file" id="fileInput" accept="audio/*" />
  <button onclick="subirArchivo()">Subir</button>
  <p id="mensaje"></p>
  <audio id="player" controls style="display: none; margin-top: 20px;"></audio>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabase = supabase.createClient(
      'https://gkeavgroxgdgbertrruj.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrZWF2Z3JveGdkZ2JlcnRycnVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzMjM3ODgsImV4cCI6MjA2MTg5OTc4OH0.HNrr972mCyzG7oEwFwyTgKUBwbm1ik630jiZQ1hiJKs'
    );

    async function subirArchivo() {
      const archivo = document.getElementById('fileInput').files[0];
      if (!archivo) return alert("Selecciona un archivo");

      const ruta = `musica/${archivo.name}`;

      // Subida
      const { error } = await supabase.storage
        .from('tracks')
        .upload(ruta, archivo, {
          cacheControl: '3600',
          upsert: true
        });

      const mensaje = document.getElementById('mensaje');
      const player = document.getElementById('player');

      if (error) {
        console.error('Error al subir:', error.message);
        mensaje.textContent = 'Error al subir: ' + error.message;
        player.style.display = 'none';
      } else {
        const { data } = supabase.storage.from('tracks').getPublicUrl(ruta);
        mensaje.textContent = 'Subido con éxito: ' + data.publicUrl;
        player.src = data.publicUrl;
        player.style.display = 'block';
        player.play();
      }
    }
  </script>
</body>
</html>
